<template>
	<view class="container">
		<!-- é¡¶éƒ¨å¥åº·ç”Ÿæ´»å›¾æ ‡ -->
		<view class="header">
			<image src="/static/icons/health-life.png" class="logo" @error="handleImageError"></image>
			<text class="title">å¥åº·ç”Ÿæ´»</text>
			<text class="subtitle">è®©æ¯ä¸€å¤©éƒ½å……æ»¡æ´»åŠ›</text>
		</view>

		<!-- ç™»å½•è¡¨å• -->
		<view class="login-form">
			<view class="form-item">
				<text class="iconfont icon-user"></text>
				<input type="text" v-model="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" class="input" />
			</view>
			<view class="form-item">
				<text class="iconfont icon-lock"></text>
				<input type="password" v-model="password" placeholder="è¯·è¾“å…¥å¯†ç " class="input" />
			</view>
			<button class="login-btn" @click="handleLogin">ç™»å½•</button>
			
			<!-- ç¬¬ä¸‰æ–¹ç™»å½• -->
			<view class="third-party-login">
				<view class="divider">
					<text class="divider-text">å…¶ä»–ç™»å½•æ–¹å¼</text>
				</view>
				<view class="login-methods">
					<view class="method-item" @click="handleWechatLogin">
						<image src="/static/icons/wechat.png" class="method-icon" @error="handleImageError"></image>
						<text>å¾®ä¿¡ç™»å½•</text>
					</view>
					<view class="method-item" @click="handleQQLogin">
						<image src="/static/icons/qq.png" class="method-icon" @error="handleImageError"></image>
						<text>QQç™»å½•</text>
					</view>
					<view class="method-item" @click="handlePhoneLogin">
						<image src="/static/icons/phone.png" class="method-icon" @error="handleImageError"></image>
						<text>æ‰‹æœºå·ç™»å½•</text>
					</view>
				</view>
			</view>
			
			<!-- å¥åº·ç”Ÿæ´»å°è´´å£« -->
			<view class="health-tips">
				<view class="tip-item">
					<text class="tip-icon">ğŸŒ±</text>
					<text class="tip-text">æ¯å¤©å–å¤Ÿ8æ¯æ°´</text>
				</view>
				<view class="tip-item">
					<text class="tip-icon">ğŸƒ</text>
					<text class="tip-text">ä¿æŒè§„å¾‹è¿åŠ¨</text>
				</view>
				<view class="tip-item">
					<text class="tip-icon">ğŸ˜´</text>
					<text class="tip-text">ä¿è¯å……è¶³ç¡çœ </text>
				</view>
			</view>
		</view>

		<!-- åº•éƒ¨æ³¨å†Œé“¾æ¥ -->
		<view class="footer">
			<text class="register-link" @click="navigateToRegister">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿç«‹å³æ³¨å†Œ</text>
		</view>
	</view>
</template>

<script setup lang="uts">
import { ref, onMounted } from 'vue'

const username = ref('')
const password = ref('')

// å›¾ç‰‡åŠ è½½é”™è¯¯å¤„ç†
const handleImageError = (e: any) => {
	console.error('å›¾ç‰‡åŠ è½½å¤±è´¥ï¼š', e)
	uni.showToast({
		title: 'å›¾ç‰‡åŠ è½½å¤±è´¥',
		icon: 'none'
	})
}

// é¡µé¢åŠ è½½å®Œæˆ
onMounted(() => {
	console.log('ç™»å½•é¡µé¢åŠ è½½å®Œæˆ')
})

// è´¦å·å¯†ç ç™»å½•
const handleLogin = () => {
	if (!username.value || !password.value) {
		uni.showToast({
			title: 'è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ',
			icon: 'none'
		})
		return
	}
	
	console.log('å¼€å§‹ç™»å½•...')
	uni.showLoading({
		title: 'ç™»å½•ä¸­...'
	})
	
	setTimeout(() => {
		uni.hideLoading()
		console.log('ç™»å½•æˆåŠŸï¼Œè·³è½¬åˆ°é¦–é¡µ')
		uni.switchTab({
			url: '/pages/index/index',
			fail: (err) => {
				console.error('è·³è½¬å¤±è´¥ï¼š', err)
				uni.showToast({
					title: 'é¡µé¢è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•',
					icon: 'none',
					duration: 2000
				})
			},
			success: () => {
				console.log('è·³è½¬æˆåŠŸ')
			}
		})
	}, 1500)
}

// å¾®ä¿¡ç™»å½•
const handleWechatLogin = () => {
	console.log('å¼€å§‹å¾®ä¿¡ç™»å½•...')
	uni.showLoading({
		title: 'å¾®ä¿¡ç™»å½•ä¸­...'
	})
	
	setTimeout(() => {
		uni.hideLoading()
		console.log('å¾®ä¿¡ç™»å½•æˆåŠŸ')
		uni.switchTab({
			url: '/pages/index/index',
			fail: (err) => {
				console.error('è·³è½¬å¤±è´¥ï¼š', err)
				uni.showToast({
					title: 'é¡µé¢è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•',
					icon: 'none',
					duration: 2000
				})
			},
			success: () => {
				console.log('è·³è½¬æˆåŠŸ')
			}
		})
	}, 1500)
}

// QQç™»å½•
const handleQQLogin = () => {
	console.log('å¼€å§‹QQç™»å½•...')
	uni.showLoading({
		title: 'QQç™»å½•ä¸­...'
	})
	
	setTimeout(() => {
		uni.hideLoading()
		console.log('QQç™»å½•æˆåŠŸ')
		uni.switchTab({
			url: '/pages/index/index',
			fail: (err) => {
				console.error('è·³è½¬å¤±è´¥ï¼š', err)
				uni.showToast({
					title: 'é¡µé¢è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•',
					icon: 'none',
					duration: 2000
				})
			},
			success: () => {
				console.log('è·³è½¬æˆåŠŸ')
			}
		})
	}, 1500)
}

// æ‰‹æœºå·ç™»å½•
const handlePhoneLogin = () => {
	console.log('å¼€å§‹æ‰‹æœºå·ç™»å½•...')
	uni.showLoading({
		title: 'æ‰‹æœºå·ç™»å½•ä¸­...'
	})
	
	setTimeout(() => {
		uni.hideLoading()
		console.log('æ‰‹æœºå·ç™»å½•æˆåŠŸ')
		uni.switchTab({
			url: '/pages/index/index',
			fail: (err) => {
				console.error('è·³è½¬å¤±è´¥ï¼š', err)
				uni.showToast({
					title: 'é¡µé¢è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•',
					icon: 'none',
					duration: 2000
				})
			},
			success: () => {
				console.log('è·³è½¬æˆåŠŸ')
			}
		})
	}, 1500)
}

// è·³è½¬åˆ°æ³¨å†Œé¡µé¢
const navigateToRegister = () => {
	console.log('è·³è½¬åˆ°æ³¨å†Œé¡µé¢')
	uni.navigateTo({
		url: '/pages/register/register',
		fail: (err) => {
			console.error('è·³è½¬å¤±è´¥ï¼š', err)
			uni.showToast({
				title: 'é¡µé¢è·³è½¬å¤±è´¥',
				icon: 'none'
			})
		}
	})
}
</script>

<style>
.container {
	min-height: 100vh;
	background-color: #F5F9FF;
	padding: 60rpx 40rpx;
	display: flex;
	flex-direction: column;
}

.header {
	display: flex;
	flex-direction: column;
	align-items: center;
	margin-bottom: 80rpx;
}

.logo {
	width: 160rpx;
	height: 160rpx;
	margin-bottom: 30rpx;
}

.title {
	font-size: 48rpx;
	font-weight: bold;
	color: #4A90E2;
	margin-bottom: 16rpx;
}

.subtitle {
	font-size: 28rpx;
	color: #666;
}

.login-form {
	background-color: #fff;
	border-radius: 24rpx;
	padding: 40rpx;
	box-shadow: 0 4rpx 16rpx rgba(74, 144, 226, 0.1);
}

.form-item {
	display: flex;
	align-items: center;
	background-color: #f8f8f8;
	border-radius: 12rpx;
	padding: 20rpx;
	margin-bottom: 30rpx;
}

.iconfont {
	font-size: 40rpx;
	color: #4A90E2;
	margin-right: 20rpx;
}

.input {
	flex: 1;
	font-size: 28rpx;
}

.login-btn {
	width: 100%;
	height: 88rpx;
	background-color: #4A90E2;
	color: #fff;
	font-size: 32rpx;
	border-radius: 44rpx;
	display: flex;
	align-items: center;
	justify-content: center;
	margin-top: 60rpx;
}

.third-party-login {
	margin-top: 60rpx;
}

.divider {
	display: flex;
	align-items: center;
	margin-bottom: 40rpx;
}

.divider::before,
.divider::after {
	content: '';
	flex: 1;
	height: 1rpx;
	background-color: #eee;
}

.divider-text {
	padding: 0 20rpx;
	font-size: 24rpx;
	color: #999;
}

.login-methods {
	display: flex;
	justify-content: space-around;
	padding: 0 40rpx;
}

.method-item {
	display: flex;
	flex-direction: column;
	align-items: center;
}

.method-icon {
	width: 80rpx;
	height: 80rpx;
	margin-bottom: 10rpx;
}

.method-item text {
	font-size: 24rpx;
	color: #666;
}

.health-tips {
	margin-top: 60rpx;
	padding-top: 40rpx;
	border-top: 1rpx solid #f0f0f0;
}

.tip-item {
	display: flex;
	align-items: center;
	margin-bottom: 20rpx;
}

.tip-icon {
	font-size: 40rpx;
	margin-right: 20rpx;
}

.tip-text {
	font-size: 26rpx;
	color: #666;
}

.footer {
	margin-top: auto;
	padding: 40rpx 0;
	text-align: center;
}

.register-link {
	font-size: 28rpx;
	color: #4A90E2;
}
</style> 